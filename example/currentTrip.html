<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../script.js"></script>
    <link rel="stylesheet" type="text/css" href="../style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap4.min.css">
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>


    <title>currentTrip</title>
</head>

<style>
    #currentTripTable tbody tr {
        cursor: pointer;
    }
</style>

<script>
    var userid = localStorage.UserID
    $(document).ready(function () {
        //show and hide button after login
        if (localStorage.UserID) {
            $('#logout').show();
            $('#gologin').hide();
            $('#firstdivider').hide();
            $('#btn-ลงชื่อเข้าใช้').css({
                'background-color': 'red',
                'color': 'white',
            })
            $('#btn-ลงชื่อเข้าใช้').text('ออกจากระบบ')
        } else {
            alert('กรุณาเข้าสู่ระบบ')
            window.location.replace('/signin_page')
        }

        //afterclick logout clearlocal storage
        $('#logout').click(function () {
            localStorage.removeItem('UserID');
            localStorage.removeItem('TripId');
            window.location.replace('/auth/logout')
        });
  
        loaddata()
    });

    function loaddata() {

        tableCurrentTrip = $('#currentTripTable').DataTable({
            "searching": false,
            "lengthChange": false,
            "paging": false,
            "ordering": false,
            "info": false,
            responsive: true,
            deferRender: true,
            columns: [
                { data: "TripID", title: "Asset_Number", "visible": false },
                { data: "No", title: "ลำดับ" },
                { data: "StartDate", title: "วันที่" },
                { data: "TripName", title: "ชื่อกิจกรรม" },

            ],

        });

        $.ajax({
            type: "get",
            url: "/CurrentTrip/" + userid,
            success: function (dataSet) {
                console.log(dataSet)
                for (let i = 0; i < dataSet.length; i++) {
                    dataSet[i].No = i + 1
                }

                //clear DataTable
                tableCurrentTrip.clear();
                //display modified JSON in DataTable
                tableCurrentTrip.rows.add(dataSet).draw();

            }
        });

        $('#currentTripTable tbody').on('click', 'td', function () {

            var data = tableCurrentTrip.row(this).data();
            var tripid = data.TripID
            console.log(tripid)
            if (tripid != null) {
                localStorage.TripID = tripid
                window.location.replace('memberManageTrip_page')
            }


        });
    }

</script>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-md navbar-light sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/"><img src="../img/logo.png" id="navLogo"></img></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" id="txt-หน้าแรก" href="/">หน้าแรก</a>
                    </li>
                    <li class="nav-item active">

                        <a class="nav-link" href="#" id="txt-ทริปท่องเที่ยว" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            ทริปท่องเที่ยว
                        </a>
                        <div class="row">
                            <div class="col-12">
                                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <a class="dropdown-item" href="/createTrip_page">สร้างทริปท่องเที่ยว</a>
                                    <a class="dropdown-item" href="/joinTrip_page">เข้าร่วมทริปท่องเที่ยว</a>
                                    <a class="dropdown-item" href="/currentTrip_page">จำนวนทริปปัจจุบัน</a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="#" id="txt-ทริปท่องเที่ยว" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            ประวัติทริปท่องเที่ยว
                        </a>
                        <div class="row">
                            <div class="col-12">
                                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <a class="dropdown-item" href="/detailTrip_page">รายเอียดกิจกรรมการท่องเที่ยว</a>
                                    <a class="dropdown-item" href="/member_page">กลุ่มสมาชิก</a>
                                    <a class="dropdown-item" href="/divideExpense_page">หารค่าใช้จ่าย</a>
                                </div>
                            </div>
                        </div>

                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" id="txt-เกี่ยวกับ" href="/about_page">เกี่ยวกับ</a>
                    </li>
                    <li class="nav-item ml-4 mr-4">
                        <a class="nav-link btn" href="#" id="btn-ลงชื่อเข้าใช้" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            ลงชื่อเข้าใช้
                        </a>
                        <div class="row">
                            <div class="col-12">
                                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <a class="dropdown-item" href="/notification_page">การแจ้งเตือน</a>
                                    <a class="dropdown-item" href="/editInfo_page">แก้ไขข้อมูล</a>
                                    <a class="dropdown-item" id="logout" href="/">ออกจากระบบ</a>
                                    <div class="dropdown-divider" id="firstdivider"></div>
                                    <!-- เอาไว้ชั่วคราว -->
                                    <a class="dropdown-item" id='gologin' href="/signin_page">ไปหน้าเข้าสู่ระบบ</a>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="row mb-5">
        <div class="col-12"></div>
    </div>
    <div class="row mb-5">
        <div class="col-12"></div>
    </div>
    <div class="row mt-5 mb-5">
        <div class="col-1"></div>
        <div class="col-10">
            <div class="background-square">
                <div class="container-fluid">
                    <div class="row mb-5">
                        <div class="col-12"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-12"></div>
                    </div>
                    <div class="row ml-4 mb-5">
                        <div class="col-1"></div>
                        <div class="heading-outerLine col-7 text-center">
                            <p class="heading" id="currentTrip-ทริปท่องเที่ยว">ทริปท่องเที่ยว</p>
                            <div class="borderLine-ทริปท่องเที่ยว"></div>
                        </div>
                        <div class="col-3">
                            <input name="txtName" class="searchBar" id="currentTrip-searchBar"
                                placeholder="ค้นหา                             &#xf002" class="w-100 h-100">
                        </div>
                        <div class="col-1"></div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-2"></div>
                        <div class="col-10">
                            <br>
                            <p class="sub-heading inner-sub-heading" id="currentTrip-จำนวนทริปปัจจุบัน">
                                จำนวนทริปปัจจุบัน</p>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-2 col-md-0 col-sm-0"></div>
                        <div class="col-lg-8 col-md-12 col-sm-12">
                            <table class="table table-striped table-bordered mt-5 fontKanit" id="currentTripTable"
                                style="width:100%">
                                <!-- <thead>
                                    <tr>
                                        <th>วันที่</th>
                                        <th>ชื่อกิจกรรม</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="cursor: pointer;" onclick="pageMemberManageTrip()">1/3/2020</td>
                                        <td style="cursor: pointer;" onclick="pageMemberManageTrip()">เที่ยวเวียดนาม
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="cursor: pointer;" onclick="pageMemberManageTrip()">15/3/2020</td>
                                        <td style="cursor: pointer;" onclick="pageMemberManageTrip()">เที่ยวเกาหลี</td>
                                    </tr>
                                </tbody> -->
                            </table>
                        </div>
                        <div class="col-lg-2 col-md-0 col-sm-0"></div>
                    </div>
                </div>
                <div class="row mb-5">
                    <div class="col-12"></div>
                </div>
                <div class="row mb-5">
                    <div class="col-12"></div>
                </div>
                <div class="row mb-5">
                    <div class="col-12"></div>
                </div>
            </div>
        </div>
        <div class="col-1"></div>
    </div>

    <!--- Footer -->
    <footer>
        <div class="container-fluid">
            <div class="row mb-4">
                <div class="col-md-12"></div>
            </div>
            <div class="row">
                <div class="col-md-1"></div>
                <div class="col-md-3">
                    <p class="txtFooter" id="txt-ft-หน้าแรก" onclick="pageHome()">หน้าแรก</p>
                </div>
                <div class="col-md-3">
                    <p class="txtFooter" id="txt-ft-ทริปท่องเที่ยว" onclick="pageTrip()">ทริปท่องเที่ยว</p>
                    <p class="txtFooter" id="txt-ft-สร้างทริปท่องเที่ยว" onclick="pageCreateTrip()">สร้างทริปท่องเที่ยว
                    </p>
                    <p class="txtFooter" id="txt-ft-เข้าร่วมทริปท่องเที่ยว" onclick="pageJoinTrip()">
                        เข้าร่วมทริปท่องเที่ยว</p>
                    <p class="txtFooter" id="txt-ft-จำนวนทริปปัจจุบัน" onclick="pageCurrentTrip()">จำนวนทริปปัจจุบัน</p>
                </div>
                <div class="col-md-3">
                    <p class="txtFooter" id="txt-ft-ประวัติการใช้งาน" onclick="pageHistory()">ประวัติทริปท่องเที่ยว</p>
                    <p class="txtFooter" id="txt-ft-รายเอียดกิจกรรมการท่องเที่ยว" onclick="pageDetailTrip()">
                        รายเอียดกิจกรรมการท่องเที่ยว</p>
                    <p class="txtFooter" id="txt-ft-กลุ่มสมาชิก" onclick="pageMember()">กลุ่มสมาชิก</p>
                    <p class="txtFooter" id="txt-ft-หาาค่าใช้จ่าย" onclick="pageDivideExpense()">หารค่าใช้จ่าย</p>
                </div>
                <div class="col-md-2">
                    <p class="txtFooter" id="txt-ft-เกี่ยวกับ" onclick="pageAbout()">เกี่ยวกับ</p>
                </div>
                <div class="col-12 mb-3">
                    <hr class="ftHr">
                    <h5 class="txtFooter  text-center">Copyright&copy2020 Mashare.All rights Reserved</h5>
                </div>
            </div>
        </div>
    </footer>
</body>

</html>